---
import Carrusel  from '../components/Carrusel.astro';
import SectionCardList from '@components/SectionCardList.astro';
import Tendencias from '@components/Tendencias.astro';
import Finalizados from '@components/Finalizados.astro';
import EnEmision from '@components/EnEmision.astro';
//URL__API = 'https://api.jikan.moe/v4/top/anime';
---


    <main>
        <!-- Carrusel -->
            <Carrusel>
                <img class="img-carrusel" src="public/assets/image/dragon-ball-fighterz-goku-gt_0.webp" alt="">
                <img class="img-carrusel" src="public/assets/image/chain.jpg" alt="">
                <img class="img-carrusel" src="public/assets/image/nezuko.jpg" alt="">
                <img class="img-carrusel" src="public/assets/image/shingeki.jpeg" alt="">
                <img class="img-carrusel" src="public/assets/image/heroacademy.jpg" alt="">
            </Carrusel>
        <!-- Mis listas -->
            <SectionCardList title="Mis listas"/>
        <!-- Tendencias -->
            <Tendencias />
        <!-- Finalizados -->
            <Finalizados />
        <!-- En emisión -->
            <EnEmision />
    </main>

<!--Funcionalidad de los botones de la card-->

<script type="module">
  document.addEventListener('DOMContentLoaded', () => {
    function actualizarBotones() {
      const vistos = JSON.parse(localStorage.getItem('animesVistos') || '[]');
      document.querySelectorAll('.button__card.view').forEach(viewBtn => {
        const id = viewBtn.getAttribute('data-id');
        const removeBtn = viewBtn.parentElement.querySelector('.button__card.remove');
        if (vistos.includes(id)) {
          viewBtn.style.display = 'none';
          if (removeBtn) removeBtn.style.display = '';
        } else {
          viewBtn.style.display = '';
          if (removeBtn) removeBtn.style.display = 'none';
        }
      });
      // Actualiza el contador si existe
      const vistosCount = document.getElementById('vistos-count');
      if (vistosCount) vistosCount.textContent = vistos.length.toString();
    }

    document.querySelectorAll('.button__card.view').forEach(viewBtn => {
      viewBtn.addEventListener('click', function (e) {
        e.preventDefault();
        const id = this.getAttribute('data-id');
        let vistos = JSON.parse(localStorage.getItem('animesVistos') || '[]');
        if (!vistos.includes(id)) {
          vistos.push(id);
          localStorage.setItem('animesVistos', JSON.stringify(vistos));
        }
        actualizarBotones();
        alert('¡Marcado como visto!');
      });
    });

    document.querySelectorAll('.button__card.remove').forEach(removeBtn => {
      removeBtn.addEventListener('click', function (e) {
        e.preventDefault();
        const id = this.getAttribute('data-id');
        let vistos = JSON.parse(localStorage.getItem('animesVistos') || '[]');
        vistos = vistos.filter(v => v !== id);
        localStorage.setItem('animesVistos', JSON.stringify(vistos));
        actualizarBotones();
        alert('Eliminado de vistos');
      });
    });

    // Inicializa el estado de los botones y contador al cargar
    actualizarBotones();
  });
</script>

<style>
    .img-carrusel {
    flex: none;
    width: 10%;
    height: 95%;
    border-radius: 180px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    object-fit: cover;
    object-position: center;
    transition: transform 0.3s ease-in-out, width 0.3s ease-in-out;
}
.img-carrusel:hover {
    transform: scale(1.05);
    width: 45%;
    margin: 0 10px;
    border-radius: 120px;
}

</style>