---
// filepath: src/components/Finalizados.astro
---

<section class="finalizados">
  <h2>Finalizados</h2>
  <ul class="finalizados-list" id="finalizados-list">
    <!-- Aquí se cargarán los animes vistos -->
  </ul>
</section>

<script type="module">
  document.addEventListener('DOMContentLoaded', async () => {
    const lista = document.getElementById('finalizados-list');
    const vistos = JSON.parse(localStorage.getItem('animesVistos') || '[]');
    if (!lista) return;
    if (!vistos.length) {
      lista.innerHTML = '<li class="finalizado-item">No tienes animes marcados como vistos.</li>';
      return;
    }
    try {
      // Jikan permite hasta 25 ids por petición
      const res = await fetch(`https://api.jikan.moe/v4/anime`);
      const data = await res.json();
      
      lista.innerHTML = data.data
        .filter(item => vistos.includes(item.mal_id))
        .map(anime => `
          <li class="finalizado-item">
            <img src="${anime.images.jpg.image_url}" alt="${anime.title}" width="50" />
            <span>${anime.title}</span>
          </li>
        `).join('');
    } catch (err) {
      lista.innerHTML = '<li class="finalizado-item">Error al cargar los animes vistos.</li>';
    }
  });
</script>

<style>
.finalizados {
  width: 100%;
  padding: 2rem;
  background-color: var(--color-background);
}
.finalizados h2 {
  font-size: 1.5rem;
  color: var(--color-text);
  margin-bottom: 1rem;
}
.finalizados-list {
  list-style-type: none;
  padding: 0;
  display: flex;
  align-items: center;
  justify-content: space-evenly;
  flex-wrap: wrap;
  gap: 1rem;
}
.finalizado-item {
  width: 200px;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.5rem;
  background-color: #f0f0f0;
  padding: 0.5rem;
  border-radius: 8px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  transition: transform 0.3s, box-shadow 0.3s;
}
.finalizado-item:hover {
  transform: scale(1.05) translateY(-5px);
  box-shadow: 0 8px 24px rgba(0,0,0,0.15);
  cursor: pointer;
}
.finalizado-item img {
  width: 100%;
  height: auto;
  border-radius: 4px;
  object-fit: cover;
}
.finalizado-item span {
  width: 100%;
  text-align: center;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  display: block;
}
</style>